<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome</title>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #f7f7f8; color: #111; }
    .topbar { display: flex; align-items: center; justify-content: space-between; background: #111; color: #fff; padding: 12px 16px; }
    .brand { font-weight: 600; }
    .left { display: flex; align-items: center; }
    .menu { display: flex; gap: 24px; margin-left: 24px; }
    .menu > .item { position: relative; cursor: pointer; }
    .menu a { color: #fff; text-decoration: none; }
    .submenu { position: absolute; top: 100%; left: 0; background: #222; border: 1px solid #333; min-width: 180px; display: none; z-index: 1000; white-space: nowrap; overflow: visible; }
    .userbox { display: flex; align-items: center; gap: 12px; }
    .userbox a { color: #fff; text-decoration: underline; }
    .submenu a { display: block; padding: 10px 12px; color: #fff; }
    .submenu a:hover { background: #333; }
    .item:hover .submenu { display: block; }
    .page { max-width: 960px; margin: 24px auto; padding: 0 16px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; }
    .muted { color: #6b7280; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="left">
      <div class="brand">Hello World App</div>
      <nav class="menu" aria-label="Main menu">
      <div class="item" id="adminMenu" aria-haspopup="true" aria-expanded="false">
        <a href="#" aria-label="Admin menu">Admin ▾</a>
        <div class="submenu" role="menu">
          <a role="menuitem" href="/manage-users.html">Manage users</a>
        </div>
      </div>
      <div class="item" aria-haspopup="true" aria-expanded="false">
        <a href="#" aria-label="Files menu">Files ▾</a>
        <div class="submenu" role="menu">
          <a role="menuitem" href="/manage-files.html">Manage files</a>
        </div>
      </div>
      </nav>
    </div>
    <div class="userbox">
      <span id="userEmail" class="muted">Loading…</span>
      <a href="#" id="signoutLink">Sign out</a>
    </div>
  </header>

  <main class="page">
    <div class="card">
      <h1>Signed in</h1>
      <p id="welcome" class="muted">Loading your session…</p>
    </div>
  </main>

  <script>
    async function loadSession() {
      try {
        const res = await fetch('/auth/me');
        const json = await res.json();
        const el = document.getElementById('welcome');
        const userEl = document.getElementById('userEmail');
        if (json && json.ok) {
          el.textContent = `Welcome, ${json.email}`;
          userEl.textContent = json.email;
          if (json.role !== 'ADMIN') {
            const admin = document.getElementById('adminMenu');
            if (admin) admin.style.display = 'none';
          }
        } else {
          userEl.textContent = '';
          // Redirect unauthenticated users to the sign-in page
          window.location.href = '/';
        }
      } catch (err) {
        document.getElementById('welcome').textContent = 'Error loading session.';
        console.error(err);
      }
    }
    loadSession();

    document.getElementById('signoutLink').addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        await fetch('/auth/signout', { method: 'POST' });
      } catch {}
      window.location.href = '/';
    });
  </script>
</body>
</html>
